---
title: "Problem Set 4 _ Stats II"
author: "Dongli Wu_21362988"
date: "4/3/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,  warning = FALSE)
# load libraries
library(survival)
library(eha)
library(tidyverse)
library(ggfortify)
library(ggplot2)
```

# Instruction

Please show your work! You may lose points by simply writing in the answer. If the problem requires you to execute commands in R, please include the code you used to get your answers. Please also include the .R file that contains your code. If you are not sure if work needs to be shown for a particular problem, please ask.
- Your homework should be submitted electronically on GitHub in .pdf form.
- This problem set is due before class on Monday April 4, 2022. No late assignments
will be accepted.
- Total available points for this homework is 80.


## Question 1
We’re interested in modeling the historical causes of infant mortality. We have data from 5641 first-born in seven Swedish parishes 1820-1895. Using the ”infants” dataset in the eha library, fit a Cox Proportional Hazard model using mother’s age and infant’s gender as covariates. Present and interpret the output.

```{r}
# import data
data(infants)
# have a look at some details about this infants data information
help(infants)
```
### A data frame with 80 rows and five variables.
- stratum: Triplet No. Each triplet consist of one infant whose mother died (a case), and two controls, i.e, infants whose mother did not die. Matched on covariates below.
- enter: Age (in days) of case when its mother died.
- exit: Age (in days) at death or right censoring (at age 365 days).
- event: Follow-up ends with death (1) or right censoring (0).
- mother: dead for cases, alive for controls.
- age: Mother's age at infant's birth.
- sex: The infant's sex.
- parish: Birth parish, either Nedertornea or not Nedertornea.
- civst: Civil status of mother, married or unmarried.
- ses: Socio-economic status of mother, either farmer or not farmer.
- year: Year of birth of the infant.

## Run a Kaplan-Meier plot for overall survival
```{r}
# build a survival object
infants_surv <- with(infants, Surv(enter, exit, event)) 

# Kaplan-Meier plot 
km <- survfit(infants_surv ~ 1, data = infants)
autoplot(km, main = "Infants Overall Survial", xlab = "Days", ylab = "Survival Rate")

# use summary function to get a general discription 
summary(km) 
```

## Run a Cox Proportional Hazard regression using mother’s age and infant’s gender
```{r}
# Cox Proportional Hazard regression
cox <- coxph(infants_surv ~ age + sex, data = infants)
summary(cox)
```
## Interpret the Cox Proportional Hazard regression
- There is a 0.04 decrease in the expected log of the hazard for mother's age at infant's birth in 1 unit increase, holding sex constant. 
- There is a 0.485 decrease in the expected log of the hazard for male babies compared to female, holding mother's age constant.

- Let's have a look at exponentiate parameter which estimates to obtain hazard ratios:

- Because for age, exp(-0.04) = 0.96, the hazard ratio of mother's age increase by 1 unit is 0.96. It indeicates that the babies are less likely to die when mother's age increase by 1 unit. We can understand it as there are 96 babies die when mother's age increase by 1 unit comparing with 100 babies die at mother's age. It means 1 unit age older of the mother, the babies deaths are 4% lower.
- Because for sexboy, exp(-0.485) = 0.62, the hazard ratio of male babies is 0.62 that of female babies. It indicates that male babies are less likely to die, as 62 male babies die for every 100 female babies. So male deaths are 38% lower than femal babies.

## Plot the Cox Proportional Hazard model with Cumulative Hazard Function
```{r}
cox_fit <- coxreg(infants_surv ~ age + sex, data = infants)
plot(cox_fit, xlab = "Days", ylab = "Cumulative Hazard")

```
## Interpret the cumulative hazard:
- Cumulative hazard function is supposed to have higher accuracy than the hazard function. We can see that our cumulative hazard function is a stair shape line with the rate under 1.5% during 250 days.The rate of change is flatter and slower at a certain constant lever after day 150, while the rate of change is sharper before day 150.

## Make a Chisq test to assess the quality of this model
```{r}
# Chisq test 
drop1(cox, test = "Chisq")
```

- As the P-Values are 0.35 for mother's age and 0.28 for babie's gender, we can say it is not a statistically significant result.



